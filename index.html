<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Career Brunch II - Tracker</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: #0d1117;
    color: #e6edf3;
    overflow-x: hidden;
    min-height: 100dvh;
  }
  header {
    background: linear-gradient(135deg, #161b22 0%, #1a1f2b 100%);
    color: #e6edf3;
    padding: 12px 16px;
    text-align: center;
    position: sticky; top: 0; z-index: 10;
    box-shadow: 0 2px 8px rgba(0,0,0,0.5);
    border-bottom: 1px solid #30363d;
  }
  header h1 { font-size: 16px; font-weight: 600; }
  header .subtitle { font-size: 11px; opacity: 0.6; margin-top: 2px; }

  .grid-container {
    padding: 8px;
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    grid-template-rows: repeat(7, 1fr);
    gap: 6px;
    min-height: calc(100dvh - 100px);
  }
  .card {
    background: #161b22;
    border-radius: 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 6px 4px;
    cursor: pointer;
    transition: transform 0.15s, box-shadow 0.15s;
    box-shadow: 0 1px 3px rgba(0,0,0,0.3);
    position: relative;
    overflow: hidden;
  }
  .card:active { transform: scale(0.95); }
  .card.visited { border: 2px solid #2ea043; }
  .card:not(.visited) { border: 2px solid #30363d; }

  .card .logo-wrap {
    width: 36px; height: 36px;
    border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    margin-bottom: 3px;
    flex-shrink: 0;
    overflow: hidden;
    background: #21262d;
  }
  .card .logo-wrap img {
    width: 32px; height: 32px;
    object-fit: contain;
    border-radius: 4px;
  }
  .card .logo-wrap .fallback-avatar {
    width: 36px; height: 36px;
    border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    font-weight: 700; font-size: 13px; color: white;
  }
  .card .name {
    font-size: 9px;
    font-weight: 600;
    text-align: center;
    line-height: 1.15;
    max-height: 22px;
    overflow: hidden;
    width: 100%;
    word-break: break-word;
    color: #e6edf3;
  }
  .card .score-badge {
    font-size: 8px;
    color: #8b949e;
    margin-top: 1px;
  }
  .card .rating-display {
    font-size: 10px;
    margin-top: 2px;
    color: #f0883e;
    letter-spacing: -1px;
  }
  .card .check-mark {
    position: absolute;
    top: 3px; right: 3px;
    font-size: 10px;
  }

  .pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    padding: 10px;
    background: #161b22;
    border-top: 1px solid #30363d;
  }
  .pagination button {
    background: #238636;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 10px 24px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: opacity 0.2s;
  }
  .pagination button:disabled { opacity: 0.3; cursor: default; }
  .pagination .page-info { font-size: 13px; font-weight: 600; color: #8b949e; }

  /* Modal / Detail overlay */
  .modal-overlay {
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.7);
    z-index: 100;
    display: none;
    align-items: flex-end;
    justify-content: center;
  }
  .modal-overlay.active { display: flex; }
  .modal {
    background: #161b22;
    width: 100%;
    max-width: 500px;
    max-height: 85dvh;
    border-radius: 20px 20px 0 0;
    overflow-y: auto;
    animation: slideUp 0.25s ease-out;
    padding: 0;
    border: 1px solid #30363d;
    border-bottom: none;
  }
  @keyframes slideUp {
    from { transform: translateY(100%); }
    to { transform: translateY(0); }
  }
  .modal-header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 20px 16px 12px;
    border-bottom: 1px solid #30363d;
    position: sticky; top: 0;
    background: #161b22;
    z-index: 1;
  }
  .modal-header .logo-wrap {
    width: 48px; height: 48px;
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
    overflow: hidden;
    background: #21262d;
  }
  .modal-header .logo-wrap img {
    width: 44px; height: 44px;
    object-fit: contain;
    border-radius: 6px;
  }
  .modal-header .logo-wrap .fallback-avatar {
    width: 48px; height: 48px;
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-weight: 700; font-size: 18px; color: white;
  }
  .modal-header .info h2 { font-size: 18px; color: #e6edf3; }
  .modal-header .info .match-score {
    font-size: 13px; color: #8b949e; margin-top: 2px;
  }
  .modal-close {
    position: absolute;
    top: 16px; right: 16px;
    background: #21262d;
    border: 1px solid #30363d;
    border-radius: 50%;
    width: 32px; height: 32px;
    font-size: 18px;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    color: #8b949e;
  }
  .modal-body { padding: 16px; }
  .detail-section {
    margin-bottom: 14px;
  }
  .detail-section .label {
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    color: #8b949e;
    margin-bottom: 4px;
    letter-spacing: 0.5px;
  }
  .detail-section .value {
    font-size: 14px;
    color: #c9d1d9;
    line-height: 1.4;
  }
  .detail-section .value:empty::after {
    content: '\2014';
    color: #484f58;
  }
  .tag-list {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
  }
  .tag {
    background: #1c3a5f;
    color: #58a6ff;
    font-size: 11px;
    padding: 3px 8px;
    border-radius: 12px;
    font-weight: 500;
  }
  .tag.sector { background: #3d2a08; color: #f0883e; }
  .tag.region { background: #0d3117; color: #3fb950; }
  .tag.lang { background: #2d1a3e; color: #bc8cff; }

  /* Rating section */
  .rating-section {
    background: #0d1117;
    border-radius: 12px;
    padding: 16px;
    margin-top: 16px;
    text-align: center;
    border: 1px solid #30363d;
  }
  .rating-section .label {
    font-size: 13px;
    font-weight: 700;
    margin-bottom: 10px;
    color: #c9d1d9;
  }
  .stars {
    display: flex;
    justify-content: center;
    gap: 8px;
  }
  .star-btn {
    background: none;
    border: 2px solid #30363d;
    border-radius: 50%;
    width: 44px; height: 44px;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.15s;
    display: flex; align-items: center; justify-content: center;
    color: #484f58;
  }
  .star-btn.active {
    background: #f0883e;
    border-color: #f0883e;
    color: white;
    transform: scale(1.1);
  }
  .clear-rating {
    margin-top: 10px;
    background: none;
    border: none;
    color: #f85149;
    font-size: 12px;
    cursor: pointer;
    padding: 6px 12px;
    font-weight: 600;
  }
  .clear-rating:hover { text-decoration: underline; }

  /* Notes */
  .notes-section {
    margin-top: 12px;
  }
  .notes-section textarea {
    width: 100%;
    border: 1px solid #30363d;
    border-radius: 8px;
    padding: 10px;
    font-size: 13px;
    font-family: inherit;
    resize: vertical;
    min-height: 60px;
    background: #0d1117;
    color: #c9d1d9;
  }
  .notes-section textarea:focus { outline: none; border-color: #58a6ff; }
  .notes-section textarea::placeholder { color: #484f58; }

  /* Stats bar */
  .stats-bar {
    display: flex;
    justify-content: space-between;
    padding: 4px 12px;
    background: #0d2818;
    font-size: 11px;
    font-weight: 600;
    color: #3fb950;
    border-bottom: 1px solid #1b4332;
  }
</style>
</head>
<body>

<header>
  <h1>Career Brunch II</h1>
  <div class="subtitle">25 Feb 2026 â€” Tap a company to view details &amp; rate</div>
</header>
<div class="stats-bar">
  <span id="statsVisited">Visited: 0 / 50</span>
  <span id="statsPage">Page 1 / 2</span>
</div>

<div class="grid-container" id="grid"></div>

<div class="pagination">
  <button id="prevBtn" onclick="changePage(-1)">&larr; Prev</button>
  <span class="page-info" id="pageInfo">1 / 2</span>
  <button id="nextBtn" onclick="changePage(1)">Next &rarr;</button>
</div>

<div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
  <div class="modal" onclick="event.stopPropagation()">
    <div class="modal-header">
      <div class="logo-wrap" id="modalLogoWrap"></div>
      <div class="info">
        <h2 id="modalName"></h2>
        <div class="match-score" id="modalScore"></div>
      </div>
      <button class="modal-close" onclick="closeModal()">&times;</button>
    </div>
    <div class="modal-body" id="modalBody"></div>
  </div>
</div>

<script>
const COMPANIES = [
  {"name":"Tessenderlo","score":94,"domain":"tessenderlo.com","interests":"Optimizing production & logistic processes","types":"Direct and competitive place, result-oriented","sector":"Supply Chain, Audit, Finance, Management","region":"Flemish Brabant, Limburg, Brussels","languages":"high: Nederlands, English, Fran\u00e7ais"},
  {"name":"Finvision","score":92,"domain":"finvision.be","interests":"Auditing","types":"Small to medium sized business","sector":"Audit, Consulting, Finance","region":"Flemish Brabant, Limburg","languages":"high: Nederlands"},
  {"name":"Robert Half","score":91,"domain":"roberthalf.com","interests":"Auditing","types":"Small to medium sized business, Belgian establishment of a multinational, Explicit hierarchy and clear career opportunities, Startup","sector":"Consulting","region":"Flemish Brabant, Limburg, Brussels","languages":"high: Nederlands, English, Fran\u00e7ais"},
  {"name":"Robert Walters","score":90,"domain":"robertwalters.com","interests":"Asset management, Auditing, Optimizing production & logistic processes","types":"Belgian establishment of a multinational","sector":"Supply Chain, Audit, Consulting, Finance, Management","region":"Flemish Brabant, Limburg, Brussels","languages":"high: Nederlands | medium: Fran\u00e7ais"},
  {"name":"Grant Thornton","score":89,"domain":"grantthornton.be","interests":"Auditing","types":"Small to medium sized business, Belgian establishment of a multinational","sector":"Audit, Consulting, Finance","region":"Flemish Brabant, Brussels","languages":"high: Nederlands, English, Fran\u00e7ais"},
  {"name":"KPMG","score":84,"domain":"kpmg.com","interests":"Asset management, Auditing","types":"Belgian establishment of a multinational, Team first corporate culture, Explicit hierarchy and clear career opportunities","sector":"Supply Chain, Audit, Consulting, Finance, Management","region":"Flemish Brabant, Limburg, Brussels","languages":"high: Nederlands, English, Fran\u00e7ais"},
  {"name":"Triple A Solutions","score":84,"domain":"tripleasolutions.be","interests":"Asset management, Auditing","types":"Small to medium sized business, Belgian establishment of a multinational, Team first corporate culture, Startup","sector":"Supply Chain, Audit, Consulting, Finance, Management","region":"Flemish Brabant, Limburg, Brussels","languages":"high: Nederlands, English, Deutsch, Fran\u00e7ais"},
  {"name":"PwC","score":83,"domain":"pwc.com","interests":"Asset management, Auditing","types":"Belgian establishment of a multinational, Team first corporate culture, Direct and competitive place, result-oriented","sector":"Supply Chain, Audit, Consulting, Finance, Management","region":"Flemish Brabant, Limburg, Brussels","languages":"high: Nederlands, English, Fran\u00e7ais"},
  {"name":"Ormit","score":83,"domain":"ormit.be","interests":"","types":"Small to medium sized business","sector":"Supply Chain, Consulting, Finance, Management","region":"Flemish Brabant, Limburg, Brussels","languages":"high: Nederlands, English, Fran\u00e7ais"},
  {"name":"Bakertilly","score":83,"domain":"bakertilly.be","interests":"Auditing","types":"Small to medium sized business","sector":"Audit, Consulting, Finance","region":"Flemish Brabant, Brussels","languages":"high: Nederlands, English, Fran\u00e7ais"},
  {"name":"Mazars","score":83,"domain":"mazars.com","interests":"Leading a team, Auditing","types":"Small to medium sized business, Belgian establishment of a multinational","sector":"Audit, Consulting, Finance","region":"Brussels","languages":"high: Nederlands, English, Fran\u00e7ais"},
  {"name":"MS Amlin","score":83,"domain":"msamlin.com","interests":"","types":"Small to medium sized business","sector":"Finance","region":"Brussels","languages":"high: Nederlands, English, Fran\u00e7ais"},
  {"name":"Katoen Natie","score":83,"domain":"katoennatie.com","interests":"Leading a team, Optimizing production & logistic processes, Products & packaging","types":"Belgian establishment of a multinational","sector":"Supply Chain, Management","region":"Limburg","languages":"high: Nederlands, English"},
  {"name":"Peeters-Govers groep","score":83,"domain":"peetersgovers.be","interests":"Leading a team, Optimizing production & logistic processes","types":"Small to medium sized business, Team first corporate culture, Direct and competitive place, result-oriented","sector":"Finance, Management","region":"Flemish Brabant, Limburg, Brussels","languages":"high: Nederlands"},
  {"name":"Student.be","score":83,"domain":"student.be","interests":"","types":"Startup","sector":"Supply Chain, Audit, Consulting, Finance, Management","region":"Flemish Brabant, Limburg, Brussels","languages":"high: Nederlands, English, Fran\u00e7ais"},
  {"name":"Bluecrux","score":82,"domain":"bluecrux.com","interests":"Optimizing production & logistic processes","types":"Small to medium sized business, Team first corporate culture, Direct and competitive place, result-oriented, Startup","sector":"Supply Chain, Consulting, Management","region":"Flemish Brabant, Brussels","languages":"high: Nederlands, English, Fran\u00e7ais"},
  {"name":"Van Reybrouck BV","score":82,"domain":"vanreybrouck.be","interests":"Asset management, Auditing","types":"Small to medium sized business, Team first corporate culture","sector":"Audit, Consulting, Finance","region":"Brussels","languages":"high: Nederlands, English, Fran\u00e7ais"},
  {"name":"Deloitte","score":81,"domain":"deloitte.com","interests":"Auditing, Optimizing production & logistic processes","types":"Belgian establishment of a multinational","sector":"Supply Chain, Audit, Consulting, Finance","region":"Flemish Brabant, Limburg, Brussels","languages":"high: Nederlands, English, Fran\u00e7ais"},
  {"name":"TAG","score":81,"domain":"tag.be","interests":"Leading a team, Optimizing production & logistic processes","types":"Small to medium sized business, Team first corporate culture","sector":"Supply Chain, Consulting, Management","region":"Flemish Brabant, Limburg, Brussels","languages":"high: Nederlands, English, Fran\u00e7ais"},
  {"name":"Moore","score":81,"domain":"moore.be","interests":"Auditing, Optimizing production & logistic processes","types":"Team first corporate culture","sector":"Supply Chain, Audit, Consulting, Finance, Management","region":"Flemish Brabant, Limburg, Brussels","languages":"high: Nederlands, English, Fran\u00e7ais"},
  {"name":"OMP","score":81,"domain":"omp.com","interests":"Optimizing production & logistic processes, Teaching","types":"Explicit hierarchy and clear career opportunities","sector":"Supply Chain, Consulting","region":"Brussels","languages":"high: English"},
  {"name":"Hays","score":81,"domain":"hays.com","interests":"Optimizing production & logistic processes","types":"Small to medium sized business, Belgian establishment of a multinational, Direct and competitive place, result-oriented","sector":"Supply Chain, Consulting, Finance","region":"Flemish Brabant, Limburg, Brussels","languages":"high: Nederlands, English, Fran\u00e7ais"},
  {"name":"Page Personnel","score":81,"domain":"pagepersonnel.be","interests":"Leading a team, Teaching","types":"Belgian establishment of a multinational, Direct and competitive place, result-oriented","sector":"Supply Chain, Audit, Consulting, Finance","region":"Flemish Brabant, Brussels","languages":"high: Nederlands, English"},
  {"name":"BDO","score":80,"domain":"bdo.be","interests":"Asset management, Auditing","types":"Belgian establishment of a multinational","sector":"Supply Chain, Audit, Consulting, Finance, Management","region":"Flemish Brabant, Limburg, Brussels","languages":"high: Nederlands, English, Deutsch, Fran\u00e7ais"},
  {"name":"Belfius","score":80,"domain":"belfius.be","interests":"Products & packaging","types":"Direct and competitive place, result-oriented","sector":"Audit, Finance, Management","region":"Flemish Brabant, Limburg, Brussels","languages":"high: Nederlands, Fran\u00e7ais"},
  {"name":"Unilever","score":80,"domain":"unilever.com","interests":"Leading a team, Optimizing production & logistic processes","types":"Team first corporate culture","sector":"Supply Chain, Finance, Management","region":"Brussels","languages":"high: Nederlands, English, Fran\u00e7ais"},
  {"name":"Reply","score":80,"domain":"reply.com","interests":"Asset management","types":"Small to medium sized business, Belgian establishment of a multinational, Explicit hierarchy and clear career opportunities","sector":"Audit, Consulting, Finance, Management","region":"Brussels","languages":"high: Nederlands, English, Fran\u00e7ais"},
  {"name":"GXO Logistics","score":80,"domain":"gxo.com","interests":"Leading a team, Optimizing production & logistic processes","types":"","sector":"Supply Chain, Audit, Finance, Management","region":"Flemish Brabant, Limburg, Brussels","languages":"high: Nederlands, English, Fran\u00e7ais"},
  {"name":"Batenborch","score":80,"domain":"batenborch.com","interests":"Leading a team","types":"Small to medium sized business, Direct and competitive place, result-oriented","sector":"Consulting, Management","region":"Flemish Brabant, Brussels","languages":"high: Nederlands, English, Fran\u00e7ais"},
  {"name":"Solvint","score":79,"domain":"solvint.eu","interests":"Optimizing production & logistic processes","types":"Small to medium sized business","sector":"Supply Chain, Consulting","region":"Flemish Brabant, Limburg, Brussels","languages":"high: Nederlands, English, Fran\u00e7ais"},
  {"name":"The Rechargers","score":79,"domain":"therechargers.be","interests":"Asset management, Optimizing production & logistic processes","types":"Startup","sector":"Consulting","region":"Flemish Brabant","languages":"high: Nederlands, English"},
  {"name":"M\u00f6bius","score":79,"domain":"mobius.eu","interests":"Optimizing production & logistic processes","types":"Small to medium sized business, Team first corporate culture","sector":"Supply Chain, Consulting, Management","region":"Flemish Brabant, Limburg, Brussels","languages":"high: Nederlands, Fran\u00e7ais"},
  {"name":"Axis Group","score":79,"domain":"axisgroup.be","interests":"Asset management","types":"Small to medium sized business, Belgian establishment of a multinational","sector":"Consulting, Finance","region":"Flemish Brabant, Brussels","languages":"high: Nederlands, English | medium: Fran\u00e7ais"},
  {"name":"C&W Logistics","score":79,"domain":"cushmanwakefield.com","interests":"Optimizing production & logistic processes","types":"Small to medium sized business","sector":"Supply Chain, Consulting","region":"","languages":"high: Nederlands, English, Fran\u00e7ais"},
  {"name":"Nalios","score":79,"domain":"nalios.be","interests":"Optimizing production & logistic processes","types":"Small to medium sized business, Startup","sector":"Consulting","region":"Flemish Brabant","languages":"high: Nederlands, English"},
  {"name":"Allianz","score":79,"domain":"allianz.com","interests":"Asset management","types":"Belgian establishment of a multinational, Team first corporate culture","sector":"Finance, Management","region":"Brussels","languages":"high: Nederlands, English"},
  {"name":"BOFIDI","score":79,"domain":"bofidi.eu","interests":"Auditing","types":"Small to medium sized business","sector":"Audit, Consulting, Finance","region":"Flemish Brabant, Limburg, Brussels","languages":"high: Nederlands, English, Fran\u00e7ais"},
  {"name":"Risk Concile","score":79,"domain":"riskconcile.com","interests":"Asset management","types":"Small to medium sized business, Startup","sector":"Finance","region":"Flemish Brabant","languages":"high: Nederlands, English, Fran\u00e7ais"},
  {"name":"Datashift","score":78,"domain":"datashift.eu","interests":"Leading a team","types":"Small to medium sized business, Team first corporate culture","sector":"Consulting, Management","region":"Flemish Brabant, Limburg, Brussels","languages":"high: Nederlands, English, Fran\u00e7ais"},
  {"name":"The Business Analysts","score":78,"domain":"thebusinessanalysts.com","interests":"Optimizing production & logistic processes","types":"Small to medium sized business","sector":"Consulting","region":"Flemish Brabant, Limburg, Brussels","languages":"high: Nederlands, English, Deutsch, Fran\u00e7ais"},
  {"name":"Finsiders","score":78,"domain":"finsiders.be","interests":"Auditing","types":"Small to medium sized business, Startup","sector":"Consulting, Finance","region":"Flemish Brabant, Limburg, Brussels","languages":"high: Nederlands, English, Fran\u00e7ais"},
  {"name":"Elia","score":78,"domain":"elia.be","interests":"Asset management","types":"","sector":"Consulting, Finance, Management","region":"Flemish Brabant, Limburg, Brussels","languages":"high: Nederlands, English, Fran\u00e7ais"},
  {"name":"ClearXperts","score":78,"domain":"clearxperts.be","interests":"Auditing","types":"Small to medium sized business","sector":"Consulting, Finance","region":"Flemish Brabant, Limburg, Brussels","languages":"high: Nederlands, English, Fran\u00e7ais"},
  {"name":"Expertum","score":78,"domain":"expertum.be","interests":"Optimizing production & logistic processes","types":"Small to medium sized business","sector":"Supply Chain, Consulting, Finance","region":"Flemish Brabant, Brussels","languages":"high: Nederlands, English"},
  {"name":"Besix","score":78,"domain":"besix.com","interests":"Auditing","types":"Belgian establishment of a multinational","sector":"Supply Chain, Audit, Finance","region":"Flemish Brabant, Limburg, Brussels","languages":"high: Nederlands, English, Fran\u00e7ais"},
  {"name":"Lanark","score":78,"domain":"lanark.be","interests":"Optimizing production & logistic processes","types":"Small to medium sized business","sector":"Supply Chain, Consulting","region":"Flemish Brabant, Limburg, Brussels","languages":"high: Nederlands, English"},
  {"name":"Vandelanotte Accountancy","score":78,"domain":"vandelanotte.be","interests":"Auditing","types":"","sector":"Audit, Consulting, Finance","region":"Brussels","languages":"high: Nederlands"},
  {"name":"Flexso","score":77,"domain":"flexso.com","interests":"Optimizing production & logistic processes","types":"Team first corporate culture","sector":"Supply Chain, Consulting, Finance, Management","region":"Flemish Brabant, Limburg, Brussels","languages":"high: Nederlands"},
  {"name":"Advieskantoor VGD","score":77,"domain":"vgd.eu","interests":"Auditing","types":"Small to medium sized business","sector":"Audit, Consulting, Finance","region":"Flemish Brabant, Limburg, Brussels","languages":"high: Nederlands"},
  {"name":"Delaware","score":77,"domain":"delaware.pro","interests":"Optimizing production & logistic processes","types":"Team first corporate culture","sector":"Supply Chain, Consulting, Finance","region":"Limburg, Brussels","languages":"high: Nederlands, English, Fran\u00e7ais"}
];

const PER_PAGE = 28;
const TOTAL_PAGES = Math.ceil(COMPANIES.length / PER_PAGE);
let currentPage = 0;

// --- Persistence via localStorage ---
function getRatings() {
  try { return JSON.parse(localStorage.getItem('cb2_ratings') || '{}'); } catch(e) { return {}; }
}
function setRating(name, val) {
  const r = getRatings(); r[name] = val; localStorage.setItem('cb2_ratings', JSON.stringify(r));
}
function clearRating(name) {
  const r = getRatings(); delete r[name]; localStorage.setItem('cb2_ratings', JSON.stringify(r));
}
function getNotes() {
  try { return JSON.parse(localStorage.getItem('cb2_notes') || '{}'); } catch(e) { return {}; }
}
function setNote(name, text) {
  const n = getNotes(); n[name] = text; localStorage.setItem('cb2_notes', JSON.stringify(n));
}

// --- Color from string ---
function hashColor(str) {
  var h = 0;
  for (var i = 0; i < str.length; i++) h = str.charCodeAt(i) + ((h << 5) - h);
  var colors = [
    '#da3633','#f0883e','#d29922','#2ea043','#1f6feb',
    '#8957e5','#bc4c00','#388bfd','#56d364','#db61a2',
    '#79c0ff','#7ee787','#ffa657','#ff7b72','#d2a8ff'
  ];
  return colors[Math.abs(h) % colors.length];
}
function initials(name) {
  var words = name.split(/[\s\-&]+/).filter(function(w) { return w.length > 0; });
  if (words.length === 1) return words[0].substring(0, 2).toUpperCase();
  return (words[0][0] + words[1][0]).toUpperCase();
}

function logoUrl(domain) {
  return 'https://logo.clearbit.com/' + domain + '?size=80';
}

function makeFallback(company, size) {
  var sz = size === 'large' ? 48 : 36;
  var fs = size === 'large' ? 18 : 13;
  var rad = size === 'large' ? 10 : 8;
  return '<div class="fallback-avatar" style="background:' + hashColor(company.name) +
    ';width:' + sz + 'px;height:' + sz + 'px;border-radius:' + rad + 'px;font-size:' + fs + 'px">' +
    initials(company.name) + '</div>';
}

function makeLogoHtml(company, size) {
  var imgSz = size === 'large' ? 44 : 32;
  var fb = makeFallback(company, size).replace(/'/g, "\\'").replace(/"/g, '&quot;');
  return '<img src="' + logoUrl(company.domain) + '" ' +
    'width="' + imgSz + '" height="' + imgSz + '" ' +
    'style="background:#fff;padding:2px;border-radius:4px" ' +
    'onerror="this.parentElement.innerHTML=\'' + fb + '\'" ' +
    'alt="' + company.name + '" loading="lazy">';
}

// --- Render Grid ---
function renderGrid() {
  var grid = document.getElementById('grid');
  grid.innerHTML = '';
  var ratings = getRatings();
  var start = currentPage * PER_PAGE;
  var end = Math.min(start + PER_PAGE, COMPANIES.length);
  var pageCompanies = COMPANIES.slice(start, end);

  pageCompanies.forEach(function(c, i) {
    var card = document.createElement('div');
    card.className = 'card' + (ratings[c.name] ? ' visited' : '');
    var rating = ratings[c.name];

    var stars = '';
    if (rating) {
      for (var s = 0; s < rating; s++) stars += '\u2605';
      for (var s2 = 0; s2 < 5 - rating; s2++) stars += '\u2606';
    }

    card.innerHTML =
      (rating ? '<div class="check-mark">\u2705</div>' : '') +
      '<div class="logo-wrap">' + makeLogoHtml(c, 'small') + '</div>' +
      '<div class="name">' + c.name + '</div>' +
      '<div class="score-badge">' + c.score + '%</div>' +
      (rating ? '<div class="rating-display">' + stars + '</div>' : '');

    (function(idx) { card.onclick = function() { openModal(idx); }; })(start + i);
    grid.appendChild(card);
  });

  // Fill remaining cells to keep grid shape
  for (var j = pageCompanies.length; j < PER_PAGE; j++) {
    var empty = document.createElement('div');
    empty.className = 'card';
    empty.style.visibility = 'hidden';
    grid.appendChild(empty);
  }

  document.getElementById('prevBtn').disabled = currentPage === 0;
  document.getElementById('nextBtn').disabled = currentPage >= TOTAL_PAGES - 1;
  document.getElementById('pageInfo').textContent = (currentPage + 1) + ' / ' + TOTAL_PAGES;
  document.getElementById('statsPage').textContent = 'Page ' + (currentPage + 1) + ' / ' + TOTAL_PAGES;

  var visited = Object.keys(ratings).length;
  document.getElementById('statsVisited').textContent = 'Visited: ' + visited + ' / ' + COMPANIES.length;
}

function changePage(dir) {
  currentPage = Math.max(0, Math.min(TOTAL_PAGES - 1, currentPage + dir));
  renderGrid();
  window.scrollTo(0, 0);
}

// --- Modal ---
function openModal(idx) {
  var c = COMPANIES[idx];
  var ratings = getRatings();
  var notes = getNotes();
  var rating = ratings[c.name] || 0;
  var note = notes[c.name] || '';

  document.getElementById('modalLogoWrap').innerHTML = makeLogoHtml(c, 'large');
  document.getElementById('modalName').textContent = c.name;
  document.getElementById('modalScore').textContent = 'Match score: ' + c.score + '%';

  var body = document.getElementById('modalBody');

  function makeTags(str, cls) {
    if (!str) return '<span style="color:#484f58">\u2014</span>';
    return str.split(',').map(function(s) { return s.trim(); }).filter(Boolean)
      .map(function(s) { return '<span class="tag ' + cls + '">' + s + '</span>'; }).join('');
  }

  var esc = c.name.replace(/'/g, "\\'");
  var html = '';

  if (c.interests) {
    html += '<div class="detail-section"><div class="label">Interests</div>' +
      '<div class="tag-list">' + makeTags(c.interests, '') + '</div></div>';
  }
  if (c.types) {
    html += '<div class="detail-section"><div class="label">Company Type</div>' +
      '<div class="tag-list">' + makeTags(c.types, '') + '</div></div>';
  }
  html += '<div class="detail-section"><div class="label">Sector</div>' +
    '<div class="tag-list">' + makeTags(c.sector, 'sector') + '</div></div>';
  if (c.region) {
    html += '<div class="detail-section"><div class="label">Region</div>' +
      '<div class="tag-list">' + makeTags(c.region, 'region') + '</div></div>';
  }
  html += '<div class="detail-section"><div class="label">Languages</div>' +
    '<div class="tag-list">' + makeTags(c.languages, 'lang') + '</div></div>';

  html += '<div class="rating-section"><div class="label">Your Interest Rating</div><div class="stars">';
  for (var n = 1; n <= 5; n++) {
    html += '<button class="star-btn ' + (n <= rating ? 'active' : '') +
      '" onclick="rate(\'' + esc + '\', ' + n + ')">' + n + '</button>';
  }
  html += '</div>';
  if (rating) {
    html += '<button class="clear-rating" onclick="unrate(\'' + esc + '\')">Clear rating</button>';
  }
  html += '</div>';

  html += '<div class="notes-section"><div class="detail-section"><div class="label">Notes</div>' +
    '<textarea placeholder="Jot down notes about this company..." ' +
    'onchange="saveNote(\'' + esc + '\', this.value)" ' +
    'onblur="saveNote(\'' + esc + '\', this.value)">' + note + '</textarea></div></div>';

  body.innerHTML = html;

  document.getElementById('modalOverlay').classList.add('active');
  document.body.style.overflow = 'hidden';
  window._currentIdx = idx;
}

function closeModal(e) {
  if (e && e.target !== document.getElementById('modalOverlay') && e.target.className !== 'modal-close') return;
  document.getElementById('modalOverlay').classList.remove('active');
  document.body.style.overflow = '';
  renderGrid();
}

function rate(name, val) {
  setRating(name, val);
  openModal(window._currentIdx);
}
function unrate(name) {
  clearRating(name);
  openModal(window._currentIdx);
}
function saveNote(name, text) {
  setNote(name, text);
}

// --- Init ---
renderGrid();
</script>
</body>
</html>
